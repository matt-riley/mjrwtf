{"id":"mjrwtf-19j","title":"Docs audit: Docker Compose testing docs parity","description":"Ensure Docker Compose testing docs are up to date and consistent between root docs and docs-site.\n\nScope:\n- `DOCKER_COMPOSE_TESTING.md`\n- `docs-site/src/content/docs/operations/docker-compose-testing.md`\n- `docker-compose.yml`\n\nChecks:\n- Same recommended workflow/commands in both docs.\n- Any referenced services, env vars, and ports match compose file.\n- Clarify prerequisites and cleanup steps.","acceptance_criteria":"- Root and docs-site Docker Compose testing docs do not contradict.\n- Commands match `docker-compose.yml` and succeed when run.\n- Links between docs are correct (if present).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.043119Z","updated_at":"2026-01-06T19:09:23.668185Z","closed_at":"2026-01-06T19:09:23.668185Z","close_reason":"Completed"}
{"id":"mjrwtf-45w","title":"Improve OpenAPI validation workflow (local + CI)","description":"OpenAPI validation currently relies on globally installed `swagger-cli` locally and installs it via `npm install -g` in CI.\n\nImprove reproducibility and speed:\n- consider `npx @apidevtools/swagger-cli` with caching, or\n- add a dedicated CI job, or\n- vendor a lightweight validator approach.\n\nRelevant:\n- Makefile `validate-openapi`\n- `.github/workflows/ci.yml` lint job","acceptance_criteria":"- `make validate-openapi` works with documented prerequisites.\n- CI validates OpenAPI without excessive install overhead.\n- Validation remains deterministic across environments.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T19:27:04.958916Z","updated_at":"2026-01-06T19:27:04.958916Z","labels":["ci","devx"]}
{"id":"mjrwtf-4z7","title":"Docs audit: Security documentation (tokens, headers, rate limits)","description":"Review security docs for accuracy and completeness.\n\nScope:\n- `SECURITY.md`\n- `docs-site/src/content/docs/security.md`\n- Auth token config (`AUTH_TOKENS` preferred, `AUTH_TOKEN` legacy)\n- Rate limiting notes and env vars\n\nChecks:\n- No instructions encourage leaking tokens (CLI args, logs).\n- `/metrics` auth behavior and config is documented correctly.\n- Rate limit env var names and defaults are correct.","acceptance_criteria":"- Security docs match current auth/rate-limit/metrics behavior.\n- No stale env var names or incorrect defaults.\n- Clear guidance on safe token handling.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.053318Z","updated_at":"2026-01-06T19:09:23.667336Z","closed_at":"2026-01-06T19:09:23.667336Z","close_reason":"Completed"}
{"id":"mjrwtf-57s","title":"TUI: created URL not visible in URL list after create (pagination/filter/offset)","description":"The Bubble Tea TUI refreshes the URL list after a successful create, but it refreshes using the *current* pagination offset (and re-applies any active filter query). If the user is not on the first page (offset\u003e0), a newly-created URL (sorted newest-first) will land on offset=0 and therefore won’t appear on the current page; the UI can even show the empty-state text which reads like there are no URLs at all.\n\nCode pointers:\n- After create success: `internal/tui/model.go` refreshes with `listURLsCmd(m.cfg, m.pageSize, m.offset)` (keeps offset) and `listURLsMsg` handling re-applies filter.\n- Empty state message in `model.go` when `len(m.filtered)==0` is: \"No URLs yet...\" which is misleading when offset\u003e0 and/or filter hides results.\n\nWhy this matches the reported symptoms:\n- Server query orders by `created_at DESC` (`internal/adapters/repository/sqlc/sqlite/queries.sql`), so new URLs appear on page 1.\n- If user was on page 2+ or had a filter applied, the new URL won’t be visible after create even though creation succeeded.","acceptance_criteria":"- Repro shows: create succeeds but URL not visible on current page.\n- Expected behavior decided and implemented (likely: on create success, jump to first page and refresh; optionally clear filter or provide an explicit toast indicating it may be filtered out).\n- Empty-state text is not misleading when offset\u003e0 and/or filter is active (e.g., differentiate \"No URLs on this page\" vs \"No URLs yet\" vs \"No matches for filter\").\n- Add/adjust TUI unit test(s) to lock in the behavior (model update after create should reset offset and/or clear filter before refreshing, per decided UX).","notes":"Research artifact written: `thoughts/shared/research/2026-01-06_cli-tui-testing-and-url-list.md` (local). It captures the likely root cause (create refresh preserves offset + filter reapply) and a concrete repro.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T14:43:19.631267Z","updated_at":"2026-01-06T14:54:11.608451Z","closed_at":"2026-01-06T14:54:11.608451Z","close_reason":"Implemented TUI fix: after create success, reset offset/cursor to 0 before refreshing so new URL appears (newest-first). Updated empty-state messaging to distinguish: no URLs yet vs no URLs on this page (offset\u003e0) vs no matches for filter; added unit tests covering offset reset and empty-state cases."}
{"id":"mjrwtf-6yr","title":"Harden CodeQL workflow: verify sqlc download checksum (like CI does)","description":"`.github/workflows/codeql.yml` installs sqlc via a `curl | tar` pipeline without verifying integrity, while `.github/workflows/ci.yml` verifies a SHA256 checksum.\n\nUpdate CodeQL workflow to match the safer pattern (download, verify checksum, install).","acceptance_criteria":"- CodeQL workflow verifies sqlc download checksum before install.\n- Workflow still succeeds on main/PR.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T19:27:04.96495Z","updated_at":"2026-01-06T19:27:04.96495Z","labels":["ci","security"]}
{"id":"mjrwtf-75o","title":"Docs audit: Docker operations docs","description":"Review Docker-related docs for correctness and consistency.\n\nScope:\n- `docs-site/src/content/docs/operations/docker.md`\n- `Dockerfile`\n- `docker-entrypoint.sh` (if referenced)\n\nChecks:\n- Build/run examples reflect current Dockerfile args/env.\n- Any published image/tag instructions are correct.\n- Confirm ports, volumes, and required env vars are accurate.","acceptance_criteria":"- Docker docs match the current Dockerfile/entrypoint behavior.\n- All documented commands work as written.\n- No outdated references to images/tags/ports.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.041014Z","updated_at":"2026-01-06T19:09:23.66743Z","closed_at":"2026-01-06T19:09:23.66743Z","close_reason":"Completed"}
{"id":"mjrwtf-7fy","title":"Docs audit: Database schema + migrations documentation","description":"Review database schema and migration docs for accuracy.\n\nScope:\n- `docs-site/src/content/docs/operations/schema.md`\n- `docs-site/src/content/docs/operations/migrations.md`\n- `internal/migrations/sqlite/` (referenced)\n- `Makefile` migration targets and `cmd/migrate`\n\nChecks:\n- Goose commands and `DATABASE_URL` usage are accurate.\n- Notes about embedded migrations (rebuild required) are correct.\n- Schema references match the current migrations/sqlc schema.","acceptance_criteria":"- Migration docs reflect actual `make` targets and `bin/migrate` behavior.\n- Schema doc matches the current DB schema.\n- No stale migration instructions remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.046618Z","updated_at":"2026-01-06T19:09:23.666643Z","closed_at":"2026-01-06T19:09:23.666643Z","close_reason":"Completed"}
{"id":"mjrwtf-a51","title":"Align golangci-lint versions and decide whether lint should block CI","description":"CI lint job uses golangci-lint action configured for `version: v2.2.0` and `continue-on-error: true` (`.github/workflows/ci.yml`). The Makefile suggests installing a different version.\n\nDecide:\n- Should lint be blocking or advisory?\n- Align documented/local version(s) with CI.","acceptance_criteria":"- Single documented golangci-lint version (or version range) and consistent usage in CI + Makefile.\n- If lint is intended to be blocking, CI fails on lint errors.\n- If advisory, rationale is documented.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T19:27:04.957579Z","updated_at":"2026-01-06T19:27:04.957579Z","labels":["ci"]}
{"id":"mjrwtf-bzq","title":"Document and validate full CLI/TUI testing workflow","description":"We need a clear, end-to-end testing guide for the `mjr` CLI (currently only `mjr tui`) that covers unit tests, integration tests, and any manual/automatable E2E checks.\n\nWhat exists today:\n- TUI has unit-level tests in `internal/tui/*_test.go` (model update behavior, create/list/delete/analytics cmd tests using `httptest`).\n- Server/API integration tests exist (e.g. `internal/infrastructure/http/server/e2e_integration_test.go`).\n- Browser UI E2E tests exist via Playwright in `e2e/` (not CLI, but relevant to overall app regression).\n\nGaps / questions to resolve:\n- How to run a realistic TUI smoke test against a running server (local SQLite) in a repeatable way.\n- Whether we want to automate TUI interaction (likely hard) vs codify a manual checklist.\n\nDeliverable:\n- Add a doc section (README or docs-site) describing: prerequisites, env vars (`MJR_BASE_URL`, `MJR_TOKEN`), commands (`go test ./...`, `make test-unit`, `make test-integration`), and a short manual smoke checklist for the TUI (list/refresh/create/delete/analytics).","acceptance_criteria":"- A single documented procedure exists for running all relevant CLI/TUI tests locally and in CI.\n- Procedure references the actual existing test commands and key env vars.\n- Includes a short manual smoke checklist for the TUI (until automation is added).","notes":"Completion notes (no code changes):\n\n## Canonical test entrypoints\nFrom repo root:\n- `make test` (runs codegen + all Go tests)\n- `make test-unit` (codegen + `go test -short ./...`)\n- `make test-integration` (codegen + server integration tests)\n\nCodegen prerequisite:\n- `make generate` (sqlc + templ); required before tests in CI.\n\nBrowser E2E (HTML UI):\n- `cd e2e \u0026\u0026 npm install`\n- `npx playwright install --with-deps chromium`\n- `npm test`\n\n## CLI/TUI-specific automated coverage\n- Unit tests: `go test ./internal/tui -run Test -v` (subset) or via `make test[-unit]`.\n- TUI cmd tests use `httptest` to validate requests to `/api/urls` etc.\n\n## Manual TUI smoke checklist (recommended)\nPre-reqs:\n- Server: set `AUTH_TOKENS`, run `go run ./cmd/server` (or `make build-server \u0026\u0026 ./bin/server`).\n- TUI: set `MJR_BASE_URL` + `MJR_TOKEN`, run `go run ./cmd/mjr tui`.\n\nChecklist:\n1) Startup: list loads (GET /api/urls), status shows “Loaded X/Y”.\n2) Refresh: press `r`, list reloads.\n3) Create: press `c`, enter valid URL, submit; confirm status “Created: … (copied…)”.\n4) Verify list shows new URL (note: see bug mjrwtf-57s re pagination/filter).\n5) Analytics: select item, press `a`, ensure analytics loads; press `b` back.\n6) Delete: press `d`, confirm with Enter/y; verify removed from list.\n7) Pagination: create enough URLs to exceed 20; verify `n/p` page.\n8) Filter: press `/`, type part of short code/original url, enter; verify filtered count.\n\nAll of the above is also captured in `thoughts/shared/research/2026-01-06_cli-tui-testing-and-url-list.md`.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T14:43:19.634872Z","updated_at":"2026-01-06T14:45:53.009127Z","closed_at":"2026-01-06T14:45:53.002328Z","close_reason":"Completed"}
{"id":"mjrwtf-c44","title":"Docs audit: Integration testing docs (unit/integration/e2e)","description":"Align and update testing documentation across the repo.\n\nScope:\n- `docs-site/src/content/docs/operations/integration-testing.md`\n- `e2e/README.md`\n- Any references in root README/Makefile\n\nChecks:\n- Correct commands for unit vs integration vs Playwright e2e.\n- Prerequisites (Playwright install, env vars) are accurate.\n- Clarify what each suite covers and when to run it.","acceptance_criteria":"- Testing docs provide correct commands for each suite.\n- Prerequisites are clearly stated.\n- No stale or broken instructions remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.057476Z","updated_at":"2026-01-06T17:59:27.297755Z","closed_at":"2026-01-06T17:59:27.297755Z","close_reason":"Updated docs-site integration testing page and e2e README with accurate unit/integration/e2e commands and prerequisites."}
{"id":"mjrwtf-cdz","title":"Fix failing CI policy test: local action flagged as unpinned","description":"`go test ./...` fails in `internal/ci`:\n\n```\n--- FAIL: TestWorkflowPolicyCheck_PassesWithPinnedActionsAndCodegen\nError: unpinned action reference:   - uses: \"./.github/actions/my-action\"\n```\n\nThe workflow policy checker treats local composite actions (`uses: \"./.github/actions/...\"`) as \"unpinned\" and fails. Local actions are not version-pinned by design, so the checker/test should allow `./.github/actions/*` (or update fixture expectations).\n\nRepro:\n- Run `go test ./...`\n- Observe failure in `internal/ci/workflow_policy_check_test.go`.\n\nLikely files:\n- `internal/ci/workflow_policy_check_test.go`\n- workflow policy check implementation under `internal/ci/`\n- workflow fixture(s) under `.github/workflows/` or testdata (if present)\n- local action under `.github/actions/`","acceptance_criteria":"- `go test ./...` passes (no failure in `internal/ci`).\n- Workflow policy check allows local actions (`uses: \"./.github/actions/...\"`) without requiring pinning.\n- Still enforces pinning for remote actions (e.g. `actions/checkout@...` must be a SHA).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T14:55:55.16475Z","updated_at":"2026-01-06T15:35:11.332848Z","closed_at":"2026-01-06T15:35:11.332848Z","close_reason":"Closed via update"}
{"id":"mjrwtf-ch8","title":"Docs audit: scripts/README and VHS tape workflows","description":"Ensure `scripts/` documentation is current and usable.\n\nScope:\n- `scripts/README.md`\n- `scripts/*.tape` (demo + TUI screenshot capture)\n\nChecks:\n- Prereqs for running tape scripts (e.g., VHS) are documented.\n- Output paths referenced by scripts still match docs-site assets.\n- Identify any stale script references or filenames.","acceptance_criteria":"- scripts README explains how to run tape scripts with correct prerequisites.\n- Tape scripts produce the documented outputs.\n- Outdated references are updated or removed.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T15:05:42.060303Z","updated_at":"2026-01-06T18:18:49.380228Z","closed_at":"2026-01-06T18:18:49.380228Z","close_reason":"Completed"}
{"id":"mjrwtf-cux","title":"Tighten CSP / reduce third-party script sources (optional hardening)","description":"Current CSP allows `unsafe-inline` and third-party CDNs (`internal/infrastructure/http/middleware/security_headers.go`). Consider hardening:\n- nonces/hashes for inline scripts/styles\n- self-hosting JS/CSS assets\n- reducing `script-src` to self\n\nThis should be staged to avoid breaking the web UI.","acceptance_criteria":"- Web UI still works.\n- CSP is strictly tighter than current policy.\n- Tests updated/added if applicable (or manual verification steps documented).","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-06T19:27:04.962075Z","updated_at":"2026-01-06T19:27:04.962075Z","labels":["frontend","security"]}
{"id":"mjrwtf-dfg","title":"Docs audit: README.md and docs-site overview alignment","description":"Review and update the primary landing docs so they match the current project behavior and commands.\n\nScope:\n- `README.md`\n- `docs-site/src/content/docs/index.mdx`\n- `docs-site/src/content/docs/getting-started/overview.md`\n\nChecks:\n- Install/build/run commands match `Makefile` targets.\n- Any referenced endpoints, env vars, and features reflect current behavior.\n- Links/images are not broken (including docs-site paths).\n\nOut of scope:\n- Implementing feature changes; doc fixes only.","acceptance_criteria":"- Root README and docs-site overview agree on recommended install/run paths.\n- All commands in these docs succeed when run as written (or clearly marked as examples).\n- Broken links/images are fixed.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.04873Z","updated_at":"2026-01-06T18:29:14.228813Z","closed_at":"2026-01-06T18:29:14.228813Z","close_reason":"Completed: README + docs overview aligned; commands updated; migrations note corrected"}
{"id":"mjrwtf-e8g","title":"Revisit CORS defaults (ALLOWED_ORIGINS) and production-hardening guidance","description":"`ALLOWED_ORIGINS` defaults to `*` (`internal/infrastructure/config/config.go`). `.env.example` warns this is not recommended for production, but the default is still permissive.\n\nDecide whether to:\n- keep `*` as default (dev-friendly) but add stronger guardrails, or\n- change the default to safer behavior with explicit configuration.\n\nAlso ensure docker-compose defaults and docs align.","acceptance_criteria":"- Documented recommended production configuration is explicit.\n- If defaults change, migration notes are provided.\n- `go test ./...` passes.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T19:27:04.960245Z","updated_at":"2026-01-06T19:27:04.960245Z","labels":["docs","security"]}
{"id":"mjrwtf-eek","title":"Docs audit: API docs vs openapi.yaml consistency","description":"Ensure docs-site API docs match `openapi.yaml` and current server responses.\n\nScope:\n- `openapi.yaml`\n- `docs-site/src/content/docs/api/index.md`\n- `docs-site/src/content/docs/api/error-handling.md`\n\nChecks:\n- Endpoint list, auth requirements, and error shapes are accurate.\n- Example requests/responses align with OpenAPI.\n- Ensure `make validate-openapi` guidance is correct.","acceptance_criteria":"- API docs and OpenAPI spec are consistent.\n- Examples reflect real response fields and error formats.\n- Any discrepancies are resolved by updating docs/spec (as appropriate).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.05223Z","updated_at":"2026-01-06T19:09:23.668314Z","closed_at":"2026-01-06T19:09:23.668314Z","close_reason":"Completed"}
{"id":"mjrwtf-h5s","title":"Add SSRF protection to URL status checker outbound requests","description":"`internal/application/url_status_checker.go` performs outbound HTTP GETs to `OriginalURL` values (and Wayback lookups). Add SSRF protections so the checker cannot access private/loopback/link-local/multicast/reserved destinations via either direct IPs or DNS resolution.\n\nRelevant files:\n- internal/application/url_status_checker.go\n- internal/infrastructure/config/config.go (.env wiring)\n- SECURITY.md (mentions SSRF as planned)\n\nNotes:\n- Prefer a denylist of RFC1918 + loopback + link-local + ULA + multicast + 0.0.0.0/8 + 100.64.0.0/10, etc.\n- Consider handling IPv6 properly.\n- Make behavior configurable if you want a non-breaking rollout (but security-default is preferred).","acceptance_criteria":"- Unit tests cover blocked targets (e.g., http://127.0.0.1, http://10.0.0.1, http://[::1]).\n- DNS-resolving hostnames that point to private ranges are blocked.\n- Public URLs still get checked successfully.\n- `go test ./...` passes.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-06T19:27:04.944213Z","updated_at":"2026-01-06T19:27:04.944213Z","labels":["security"]}
{"id":"mjrwtf-jjo","title":"Add pinned local dev tool installer (sqlc/templ/golangci-lint/swagger-cli)","description":"Reduce local setup friction by adding a first-class way to install the project’s required tools at pinned versions.\n\nCandidates:\n- `make tools` / `make install-tools`\n- docs updates to recommend it\n\nTools involved:\n- sqlc\n- templ\n- golangci-lint\n- swagger-cli (or an alternative that avoids global install)","acceptance_criteria":"- One command installs required toolchain at pinned versions (documented).\n- Versions match CI.\n- No secrets or global side effects beyond tool installs.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T19:27:04.96118Z","updated_at":"2026-01-06T19:27:04.96118Z","labels":["ci","devx"]}
{"id":"mjrwtf-joc","title":"Implement per-token identity (multi-tenant) for API + web sessions","description":"Bearer auth currently assigns `userID := \"authenticated-user\"` for all valid tokens (`internal/infrastructure/http/middleware/auth.go`). Web UI login and create flows do the same (`internal/infrastructure/http/handlers/page_handler.go`). This effectively makes the system single-tenant.\n\nImplement a stable derived identity per token (e.g., `sha256(token)` prefix) and use it consistently:\n- API bearer auth\n- Web login/session creation\n- Any ownership checks (`created_by`)\n\nAlso update OpenAPI text that calls out single-tenant behavior.","acceptance_criteria":"- Two distinct tokens produce distinct `created_by` values.\n- Token A cannot list/delete/see analytics for Token B URLs.\n- Existing single-token setup still works.\n- Tests updated/added to cover multi-token isolation.\n- `go test ./...` passes.","notes":"Research notes (2026-01-06):\n\nRepo currently *already* enforces isolation purely via `created_by` (DB column + repo filtering + use-case ownership checks); the missing piece is that all valid tokens map to the same hardcoded identity.\n\nHardcoded identity locations (\"authenticated-user\"):\n- `internal/infrastructure/http/middleware/auth.go` (Bearer auth middleware): `userID := \"authenticated-user\"`\n- `internal/infrastructure/http/handlers/page_handler.go`\n  - HTML create flow: `userID := \"authenticated-user\"` then `CreateURLRequest{CreatedBy: userID}`\n  - Login flow/session creation: `userID := \"authenticated-user\"` then `sessionStore.Create(userID)`\n\nHow identity is used today:\n- API handlers (`internal/infrastructure/http/handlers/url_handler.go`, `analytics_handler.go`) read `middleware.GetUserID(r.Context())` and pass it into the application layer as `CreatedBy` / `RequestedBy`.\n- Authorization checks are already based on string equality:\n  - Delete: `internal/application/delete_url.go` checks `foundURL.CreatedBy != req.RequestedBy` =\u003e `ErrUnauthorizedDeletion`\n  - Analytics: `internal/application/get_analytics.go` checks `foundURL.CreatedBy != req.RequestedBy` (currently returns `ErrUnauthorizedDeletion`)\n- Listing/counting is already scoped by created_by:\n  - `internal/application/list_urls.go` calls `urlRepo.List(ctx, req.CreatedBy, ...)` and `urlRepo.Count(ctx, req.CreatedBy)`\n  - SQL layer supports this (`internal/adapters/repository/sqlc/sqlite/queries.sql` has `WHERE created_by = ?`; schema has an index on `urls(created_by)` in `internal/migrations/sqlite/00001_initial_schema.sql`).\n\nDocs/spec touchpoints that explicitly mention single-tenant identity:\n- `openapi.yaml` examples/field example values include `created_by: \"authenticated-user\"` (e.g. around lines ~127, ~133, and component example ~504).\n- `docs-site/src/content/docs/api/index.md` explicitly notes single-tenant behavior in “List URLs” and “Analytics” sections.\n\nTests that currently encode the single shared identity and will likely need updates once per-token identity is implemented:\n- `internal/infrastructure/http/middleware/auth_test.go`\n- `internal/infrastructure/http/middleware/session_or_bearer_auth_test.go`\n- `internal/infrastructure/http/server/auth_integration_test.go`\n- `internal/infrastructure/http/server/session_auth_integration_test.go`\n- `internal/infrastructure/http/server/analytics_integration_test.go`\n\nImplementation note (design option):\n- You can keep the current constant-time token validation, then derive identity directly from the *presented* token (after it’s validated) using a deterministic one-way transform (e.g., `sha256(token)` -\u003e hex string, possibly truncated). This avoids needing to know which configured token matched (the code currently only returns match/configured booleans) and avoids storing/logging raw tokens.\n","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-06T19:27:04.952731Z","updated_at":"2026-01-06T19:32:56.529406Z","labels":["feature","security"]}
{"id":"mjrwtf-kei","title":"Decouple Makefile test targets from code generation","description":"`make test` / `make test-unit` / `make test-integration` currently depend on `generate`, forcing local installs of `sqlc` + `templ` even though generated code is committed and CI already verifies it.\n\nAdjust Makefile targets so tests can run without codegen tooling by default, while keeping a dedicated `make generate` / `make check` flow and CI generation verification (`.github/workflows/ci.yml`).","acceptance_criteria":"- `make test` runs tests without running `sqlc generate` / `templ generate`.\n- CI still fails when generated code is stale (existing generate-check job).\n- `go test ./...` and CI jobs still pass.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T19:27:04.955167Z","updated_at":"2026-01-06T19:27:04.955167Z","labels":["devx"]}
{"id":"mjrwtf-mqt","title":"Docs audit: Contributing / community docs consistency","description":"Review contributing/community docs and ensure they match current workflows.\n\nScope:\n- `CONTRIBUTING.md`\n- `CODE_OF_CONDUCT.md`\n- `AGENTS.md`\n- `docs-site/src/content/docs/contributing/index.md`\n\nChecks:\n- Dev workflow: generation (`make generate`), tests (`make test-unit`, `make test-integration`), lint/vet.\n- Any repo policies (PR expectations, formatting) are accurate.\n- Links between contributing docs and docs-site are correct.","acceptance_criteria":"- Contributing docs accurately describe the current dev workflow.\n- No broken links.\n- Guidance matches actual `make` targets and repo expectations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.055673Z","updated_at":"2026-01-06T19:09:23.66761Z","closed_at":"2026-01-06T19:09:23.66761Z","close_reason":"Completed"}
{"id":"mjrwtf-o2g","title":"Update SECURITY.md to reflect implemented vs planned mitigations","description":"SECURITY.md lists a mix of implemented and planned mitigations. After SSRF and/or other hardening changes land, update SECURITY.md so it accurately reflects reality and points to the right configuration knobs.","acceptance_criteria":"- SECURITY.md accurately matches current behavior.\n- Any new config flags are documented.","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-06T19:27:04.963545Z","updated_at":"2026-01-06T19:27:04.963545Z","labels":["docs"]}
{"id":"mjrwtf-ood","title":"Docs audit: Getting Started (local development + configuration)","description":"Ensure Getting Started docs reflect current configuration, env vars, and local dev workflow.\n\nScope:\n- `docs-site/src/content/docs/getting-started/local-development.md`\n- `docs-site/src/content/docs/getting-started/configuration.md`\n\nChecks:\n- Env vars documented match current config (`AUTH_TOKENS`, `METRICS_AUTH_ENABLED`, rate limit vars, etc.).\n- Local dev instructions cover generation (`make generate`), build/run, and database setup expectations.\n- Mention any required prerequisites (Go version, sqlc/templ if needed).","acceptance_criteria":"- Getting Started docs match current env var/config behavior.\n- Commands and example env var names are accurate.\n- No stale flags/variables remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.037218Z","updated_at":"2026-01-06T19:09:23.667189Z","closed_at":"2026-01-06T19:09:23.667189Z","close_reason":"Completed"}
{"id":"mjrwtf-qq5","title":"Optionally block private-network destinations at URL creation time","description":"Domain URL validation currently checks only scheme + host (`internal/domain/url/url.go`). Consider adding an SSRF/private-network guard during URL creation so users cannot shorten internal-only destinations.\n\nThis should be configurable to avoid breaking existing installs that intentionally shorten internal URLs.\n\nRelevant files:\n- internal/domain/url/url.go\n- internal/application/create_url.go (if enforcement belongs here)\n- internal/infrastructure/config/config.go + .env.example","acceptance_criteria":"- A config flag controls whether private/loopback/link-local targets are rejected at creation.\n- Tests demonstrate behavior when enabled vs disabled.\n- OpenAPI and docs describe the behavior.\n- `go test ./...` passes.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T19:27:04.951114Z","updated_at":"2026-01-06T19:27:04.951114Z","labels":["api","security"]}
{"id":"mjrwtf-s7i","title":"Docs audit: internal component READMEs (domain/http/notifications/templates)","description":"Review internal package READMEs to ensure they match the current architecture and usage.\n\nScope:\n- `internal/domain/README.md`\n- `internal/infrastructure/http/README.md`\n- `internal/adapters/notification/README.md`\n- `internal/adapters/http/templates/README.md`\n\nChecks:\n- Ensure they reflect current package responsibilities and integration points.\n- Update any code examples or referenced paths.\n- Ensure they don’t contradict the docs-site architecture guidance (if any).","acceptance_criteria":"- Internal READMEs are accurate and not stale.\n- Examples compile (or are clearly illustrative).\n- References/links are correct.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T15:05:42.072126Z","updated_at":"2026-01-06T17:18:31.45943Z","closed_at":"2026-01-06T17:18:31.45943Z","close_reason":"Completed"}
{"id":"mjrwtf-scz","title":"Docs audit: Observability (health/metrics/logging)","description":"Validate observability documentation against the current server behavior.\n\nScope:\n- `docs-site/src/content/docs/operations/observability.md`\n- Any referenced endpoints `/health`, `/metrics`\n- Env vars impacting metrics auth (`METRICS_AUTH_ENABLED`) and logging\n\nChecks:\n- Endpoint paths and auth expectations are correct.\n- Prometheus scrape examples (if any) are accurate.\n- No sensitive-data logging recommendations contradict actual behavior.","acceptance_criteria":"- Observability docs match the current endpoints and auth behavior.\n- Env var names and defaults are correct.\n- Examples are runnable and safe.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:05:42.061454Z","updated_at":"2026-01-06T17:29:53.444747Z","closed_at":"2026-01-06T17:29:53.444747Z","close_reason":"Completed"}
{"id":"mjrwtf-waj","title":"Update docs-site TUI screenshots to match current UI/empty states","description":"The TUI empty-state messaging and create-refresh behavior changed (see mjrwtf-57s). We should refresh the docs-site TUI screenshots to match the current UI text/layout.\n\nCurrent screenshot assets:\n- `docs-site/public/images/tui/screenshots/`\n  - `tui-empty-{light,dark}.png`\n  - `tui-browsing-{light,dark}.png`\n  - `tui-create-{light,dark}.png`\n  - `tui-delete-confirmation-{light,dark}.png`\n  - `tui-analytics-{light,dark}.png`\n\nScripts for generating screenshots (likely VHS):\n- `scripts/tui-screenshots-light.tape`\n- `scripts/tui-screenshots-dark.tape`\n\nDocs page referencing them:\n- `docs-site/src/content/docs/operations/tui.md`\n\nWork:\n- Re-run the screenshot capture scripts (or update them if needed) and replace the PNGs in `docs-site/public/images/tui/screenshots/`.\n- Verify the docs page renders correctly with the updated images.","acceptance_criteria":"- TUI screenshots in `docs-site/public/images/tui/screenshots/` reflect the current UI (including updated empty-state text).\n- If capture scripts need changes, update `scripts/tui-screenshots-*.tape` accordingly.\n- `docs-site/src/content/docs/operations/tui.md` references remain valid (no broken image paths).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:01:52.784641Z","updated_at":"2026-01-06T17:23:26.358729Z","closed_at":"2026-01-06T17:23:26.358729Z","close_reason":"Closed"}
{"id":"mjrwtf-xwb","title":"Docs audit: release/changelog process documentation","description":"Review documentation around releases and changelog generation.\n\nScope:\n- `CHANGELOG.md`\n- `release-please-manifest.json`\n- Any README/docs-site references to releases/tags\n\nChecks:\n- Ensure release process (release-please, tags) is documented correctly.\n- Changelog formatting and expectations are clear.\n- Remove or update stale release instructions.","acceptance_criteria":"- Release/changelog documentation reflects current release tooling.\n- Any referenced commands/process steps are accurate.\n- No stale references remain.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T15:05:42.06315Z","updated_at":"2026-01-06T18:18:49.382636Z","closed_at":"2026-01-06T18:18:49.382636Z","close_reason":"Completed"}
{"id":"mjrwtf-ycu","title":"Tailscale Network-Based Authentication","description":"Implement Tailscale network-based authentication for mjr.wtf URL shortener to protect admin routes while keeping public routes accessible.\n\n## Background\n\nThe main part of this application (index page and short URL redirects) should remain public. However, the admin section (dashboard, API endpoints) should only be accessible to people on the Tailscale network. This means anyone on the Tailscale network would be able to add/delete URLs without additional authentication - network membership IS the authentication.\n\n## Research\n\n**READ THE PIECES MEMORY FIRST**: This epic is based on extensive research into Tailscale authentication approaches. Before starting implementation, query Pieces for the research memory about \"Tailscale authentication integration for mjr.wtf\" to understand:\n- The three approaches considered (tsnet, reverse proxy, dual deployment)\n- Why tsnet was chosen as the recommended approach\n- How Tailscale Serve and Funnel work together\n- WhoIs API for user identification\n- Security considerations and trade-offs\n\n## Implementation Approach\n\nUsing **tsnet library** to embed Tailscale directly into the Go application:\n- Application becomes a full Tailscale node with its own IP on the tailnet\n- Public routes (/, /{shortCode}) exposed via Tailscale Funnel (public internet)\n- Admin routes (/dashboard, /api/*) remain private to tailnet via Tailscale Serve\n- WhoIs API identifies Tailscale users and populates request context\n- Single binary deployment with no reverse proxy needed\n\n## Implementation Plan\n\nA detailed 12-step implementation plan exists at: `plans/2026-01-13_tailscale-tsnet-integration.md`\n\nKey implementation areas:\n1. Add Tailscale dependencies (tsnet, client libraries)\n2. Create Tailscale configuration layer\n3. Build WhoIs authentication middleware\n4. Update server initialization for dual-mode support\n5. Conditional route protection based on Tailscale vs. standard mode\n6. Integration testing for both modes\n7. Documentation and Funnel configuration\n8. Docker support with Tailscale state persistence\n\n## Backward Compatibility\n\nThis implementation maintains full backward compatibility:\n- `TAILSCALE_ENABLED=false` by default\n- Existing Bearer token and session authentication continues working\n- Zero-downtime migration path\n- TUI client requires no changes when on Tailscale network\n\n## References\n\n- Implementation plan: `plans/2026-01-13_tailscale-tsnet-integration.md`\n- Pieces memory: Tailscale authentication research (2026-01-13)\n- tsnet docs: https://tailscale.com/kb/1244/tsnet\n- Funnel docs: https://tailscale.com/kb/1223/funnel","status":"open","priority":1,"issue_type":"epic","owner":"matt@mattriley.me","created_at":"2026-01-13T12:39:39.296228Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:39:39.296228Z","labels":["authentication","infrastructure","security","tailscale"]}
{"id":"mjrwtf-ycu.1","title":"Add Tailscale Dependencies","description":"Install tsnet and Tailscale client libraries.\n\n**Packages:**\n- tailscale.com/tsnet@latest\n- tailscale.com/client/tailscale@latest\n\n**Commands:**\n```bash\ngo get tailscale.com/tsnet@latest\ngo get tailscale.com/client/tailscale@latest\ngo mod tidy\n```\n\n**Verification:**\n```bash\ngo list -m tailscale.com/tsnet\ngo list -m tailscale.com/client/tailscale\n```\n\n**Files Modified:**\n- go.mod\n- go.sum\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 1 for full details.","status":"open","priority":1,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":15,"created_at":"2026-01-13T12:44:35.44994Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:44:35.44994Z","labels":["dependencies","setup"],"dependencies":[{"issue_id":"mjrwtf-ycu.1","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:44:35.452083Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.10","title":"Configure Tailscale Funnel for Public Routes","description":"Set up Tailscale Funnel to expose public routes to the internet.\n\n**Tasks:**\n1. Create helper script: `scripts/configure-tailscale-funnel.sh`\n2. Document Funnel commands to expose public routes:\n   ```bash\n   tailscale funnel --bg --https=443 --set-path=/ on\n   tailscale funnel --bg --https=443 --set-path=/{shortCode} on\n   tailscale funnel status\n   ```\n3. Add Makefile target: `make tailscale-funnel-setup`\n4. Test public route accessibility via Funnel URL from non-Tailscale network\n5. Verify admin routes NOT accessible via Funnel\n\n**Funnel Behavior:**\n- Public routes (/, /{shortCode}) accessible from internet via Funnel URL\n- Admin routes (/dashboard, /api/*) remain tailnet-only\n\n**Verification:**\n```bash\n# From non-Tailscale network\ncurl https://\u003cfunnel-url\u003e/ # Should work\ncurl https://\u003cfunnel-url\u003e/dashboard # Should fail (404 or 401)\n```\n\n**Files Created:**\n- scripts/configure-tailscale-funnel.sh\n\n**Files Modified:**\n- Makefile (add tailscale-funnel-setup target)\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 10.","status":"open","priority":2,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":30,"created_at":"2026-01-13T12:46:16.149036Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:46:16.149036Z","labels":["deployment","tailscale"],"dependencies":[{"issue_id":"mjrwtf-ycu.10","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:46:16.150883Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.10","depends_on_id":"mjrwtf-ycu.8","type":"blocks","created_at":"2026-01-13T12:46:16.154472Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.11","title":"Update Docker Configuration for Tailscale Support","description":"Modify Docker setup to support Tailscale state persistence and configuration.\n\n**Tasks:**\n1. Update Dockerfile:\n   - Support Tailscale state directory\n   - Ensure appropriate directory permissions\n2. Update docker-compose.yml:\n   - Add Tailscale environment variables\n   - Add volume mount for Tailscale state persistence (`./tailscale-state:/app/tailscale-state`)\n   - Document required environment variables\n3. Update DOCKER_COMPOSE_TESTING.md with Tailscale deployment instructions\n4. Test Docker deployment with Tailscale enabled\n\n**Environment Variables to Add:**\n```yaml\nenvironment:\n  - TAILSCALE_ENABLED=true\n  - TAILSCALE_HOSTNAME=mjrwtf\n  - TAILSCALE_AUTH_KEY=${TAILSCALE_AUTH_KEY}\n  - TAILSCALE_STATE_DIR=/app/tailscale-state\n```\n\n**Volume Mount:**\n```yaml\nvolumes:\n  - ./tailscale-state:/app/tailscale-state\n```\n\n**Verification:**\n```bash\nmake docker-compose-up\n# Check logs for Tailscale initialization\ndocker-compose logs | grep -i tailscale\n```\n\n**Files Modified:**\n- Dockerfile\n- docker-compose.yml\n- DOCKER_COMPOSE_TESTING.md\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 11.","status":"open","priority":2,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":45,"created_at":"2026-01-13T12:46:27.365942Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:46:27.365942Z","labels":["deployment","docker"],"dependencies":[{"issue_id":"mjrwtf-ycu.11","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:46:27.368135Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.11","depends_on_id":"mjrwtf-ycu.2","type":"blocks","created_at":"2026-01-13T12:46:27.37079Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.11","depends_on_id":"mjrwtf-ycu.3","type":"blocks","created_at":"2026-01-13T12:46:27.372863Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.12","title":"Add Backward Compatibility Validation and Logging","description":"Ensure application works in both Tailscale and standard modes with appropriate warnings.\n\n**Tasks:**\n1. Add startup logging to indicate which mode is active\n2. Add deprecation warning for Bearer token auth when Tailscale is available\n3. Update config validation to ensure both modes work correctly\n4. Document migration path from Bearer tokens to Tailscale\n5. Test both modes thoroughly\n\n**Logging to Add:**\n```go\nif cfg.TailscaleEnabled {\n    logger.Info().Msg(\"Tailscale mode enabled - admin routes protected by network authentication\")\n} else {\n    logger.Warn().Msg(\"Running in standard mode - consider enabling Tailscale for improved security\")\n}\n```\n\n**Verification:**\n- Test with TAILSCALE_ENABLED=false: Bearer/Session auth works\n- Test with TAILSCALE_ENABLED=true: Tailscale auth works\n- Verify appropriate warnings logged\n- Verify no breaking changes to existing deployments\n\n**Files Modified:**\n- internal/infrastructure/config/config.go (validation warnings)\n- cmd/server/main.go (startup logging)\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 12.","status":"open","priority":1,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":30,"created_at":"2026-01-13T12:46:39.593124Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:46:39.593124Z","labels":["backward-compatibility"],"dependencies":[{"issue_id":"mjrwtf-ycu.12","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:46:39.596257Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.12","depends_on_id":"mjrwtf-ycu.6","type":"blocks","created_at":"2026-01-13T12:46:39.60038Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.2","title":"Add Tailscale Configuration to Config Layer","description":"Add Tailscale configuration fields and environment variable parsing.\n\n**Config Fields to Add:**\n- TailscaleEnabled (bool)\n- TailscaleHostname (string)\n- TailscaleAuthKey (string)\n- TailscaleStateDir (string)\n- TailscaleFunnelEnabled (bool)\n- TailscaleControlURL (string)\n\n**Tasks:**\n1. Add fields to Config struct in config.go\n2. Add environment variable parsing (TAILSCALE_ENABLED, TAILSCALE_HOSTNAME, etc.)\n3. Add validation logic for Tailscale configuration\n4. Update .env.example with Tailscale variables and documentation\n5. Update config_test.go with tests for new fields\n\n**Verification:**\n```bash\nmake test # Config tests should pass\n```\n\n**Files Modified:**\n- internal/infrastructure/config/config.go\n- internal/infrastructure/config/config_test.go\n- .env.example\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 2.","status":"open","priority":1,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":45,"created_at":"2026-01-13T12:44:45.238017Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:44:45.238017Z","labels":["configuration"],"dependencies":[{"issue_id":"mjrwtf-ycu.2","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:44:45.240086Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.2","depends_on_id":"mjrwtf-ycu.1","type":"blocks","created_at":"2026-01-13T12:44:45.242856Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.3","title":"Create Tailscale Network Layer","description":"Create infrastructure package for Tailscale tsnet server wrapper.\n\n**Tasks:**\n1. Create package `internal/infrastructure/tailscale/`\n2. Implement TailscaleServer struct wrapping tsnet.Server\n3. Add initialization: NewTailscaleServer(cfg, logger)\n4. Add Listen() method to return net.Listener\n5. Add Hostname() method to get assigned Tailscale hostname\n6. Add Close() for graceful shutdown\n7. Add error handling and logging\n8. Create unit tests with mocked tsnet\n\n**Key Functionality:**\n```go\ntype TailscaleServer struct {\n    server *tsnet.Server\n    logger zerolog.Logger\n}\n\nfunc NewTailscaleServer(cfg *config.Config, logger zerolog.Logger) (*TailscaleServer, error)\nfunc (ts *TailscaleServer) Listen(network, addr string) (net.Listener, error)\nfunc (ts *TailscaleServer) Hostname() string\nfunc (ts *TailscaleServer) Close() error\n```\n\n**Verification:**\n```bash\nmake test # Unit tests for tailscale package\n```\n\n**Files Created:**\n- internal/infrastructure/tailscale/server.go\n- internal/infrastructure/tailscale/doc.go\n- internal/infrastructure/tailscale/server_test.go\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 3.","status":"open","priority":1,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":90,"created_at":"2026-01-13T12:44:55.788504Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:44:55.788504Z","labels":["infrastructure","tailscale"],"dependencies":[{"issue_id":"mjrwtf-ycu.3","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:44:55.791074Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.3","depends_on_id":"mjrwtf-ycu.2","type":"blocks","created_at":"2026-01-13T12:44:55.793941Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.4","title":"Create Tailscale WhoIs Authentication Middleware","description":"Implement middleware for Tailscale user authentication using WhoIs API.\n\n**Tasks:**\n1. Create `internal/infrastructure/http/middleware/tailscale_auth.go`\n2. Implement TailscaleAuth middleware function\n3. Call Tailscale WhoIs API to get user identity from remote IP\n4. Extract user info (login, name, email) and store in request context\n5. Handle WhoIs failures (return 401 with error message)\n6. Add logging for authentication events\n7. Create comprehensive unit tests with mocked WhoIs responses\n\n**Middleware Signature:**\n```go\nfunc TailscaleAuth(tsServer *tailscale.TailscaleServer) func(http.Handler) http.Handler\n```\n\n**Context Keys:**\n```go\nconst (\n    TailscaleUserKey     contextKey = \"tailscale_user\"\n    TailscaleLoginKey    contextKey = \"tailscale_login\"\n    TailscaleNameKey     contextKey = \"tailscale_name\"\n)\n```\n\n**Verification:**\n```bash\nmake test # Unit tests for middleware\n```\n\n**Files Created:**\n- internal/infrastructure/http/middleware/tailscale_auth.go\n- internal/infrastructure/http/middleware/tailscale_auth_test.go\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 4.","status":"open","priority":1,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":90,"created_at":"2026-01-13T12:45:07.446994Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:45:07.446994Z","labels":["authentication","middleware","tailscale"],"dependencies":[{"issue_id":"mjrwtf-ycu.4","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:45:07.448872Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.4","depends_on_id":"mjrwtf-ycu.3","type":"blocks","created_at":"2026-01-13T12:45:07.451933Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.5","title":"Update Server Initialization for Dual-Mode Support","description":"Modify server initialization to support both Tailscale and standard HTTP modes.\n\n**Tasks:**\n1. Modify `cmd/server/main.go` to check cfg.TailscaleEnabled\n2. If Tailscale enabled:\n   - Create TailscaleServer instance\n   - Get listener from tsnet: listener := tsServer.Listen(\"tcp\", \":443\")\n   - Pass listener to HTTP server\n3. If Tailscale disabled:\n   - Use existing standard HTTP server logic\n4. Update shutdown logic to close Tailscale connection\n5. Add startup logging to indicate which mode is active\n\n**Logic Flow:**\n```go\nif cfg.TailscaleEnabled {\n    tsServer := tailscale.NewTailscaleServer(cfg, logger)\n    listener := tsServer.Listen(\"tcp\", \":443\")\n    // Pass listener and tsServer to HTTP server\n} else {\n    // Existing standard HTTP server logic\n}\n```\n\n**Verification:**\n- Test with TAILSCALE_ENABLED=false (standard mode)\n- Test with TAILSCALE_ENABLED=true (tsnet mode)\n- Verify server starts correctly in both modes\n\n**Files Modified:**\n- cmd/server/main.go\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 5.","status":"open","priority":1,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":60,"created_at":"2026-01-13T12:45:18.234506Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:45:18.234506Z","labels":["infrastructure","server"],"dependencies":[{"issue_id":"mjrwtf-ycu.5","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:45:18.235588Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.5","depends_on_id":"mjrwtf-ycu.3","type":"blocks","created_at":"2026-01-13T12:45:18.236845Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.6","title":"Update HTTP Server for Conditional Route Protection","description":"Modify HTTP server to conditionally apply Tailscale authentication to admin routes.\n\n**Tasks:**\n1. Modify server.New() to accept optional Tailscale server parameter\n2. Store TailscaleServer instance in Server struct\n3. Update setupRoutes() to conditionally apply middleware:\n   - If Tailscale enabled: Use TailscaleAuth middleware for admin routes\n   - If Tailscale disabled: Use existing Bearer/Session auth (fallback)\n4. Keep public routes (/, /{shortCode}) unauthenticated\n\n**Route Protection Strategy:**\n```go\n// Public routes (always accessible, will be exposed via Funnel)\ns.router.Get(\"/\", pageHandler.Home)\ns.router.Get(\"/{shortCode}\", redirectHandler.Redirect)\n\n// Admin routes (conditional auth)\nif s.tailscaleServer != nil {\n    // Tailscale mode: use WhoIs auth\n    s.router.With(middleware.TailscaleAuth(s.tailscaleServer)).Get(\"/dashboard\", ...)\n    s.router.Route(\"/api\", func(r chi.Router) {\n        r.Use(middleware.TailscaleAuth(s.tailscaleServer))\n        // API routes\n    })\n} else {\n    // Standard mode: use existing auth\n    s.router.With(middleware.RequireSession(...)).Get(\"/dashboard\", ...)\n    s.router.Route(\"/api\", func(r chi.Router) {\n        r.Use(middleware.SessionOrBearerAuth(...))\n        // API routes\n    })\n}\n```\n\n**Verification:**\n- Test route protection with Tailscale enabled\n- Test fallback behavior with Tailscale disabled\n\n**Files Modified:**\n- internal/infrastructure/http/server/server.go\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 6.","status":"open","priority":1,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":90,"created_at":"2026-01-13T12:45:31.309619Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:45:31.309619Z","labels":["authentication","routing"],"dependencies":[{"issue_id":"mjrwtf-ycu.6","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:45:31.311688Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.6","depends_on_id":"mjrwtf-ycu.4","type":"blocks","created_at":"2026-01-13T12:45:31.314976Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.6","depends_on_id":"mjrwtf-ycu.5","type":"blocks","created_at":"2026-01-13T12:45:31.316827Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.7","title":"Update Page Handlers for Tailscale User Context","description":"Modify dashboard and admin page handlers to use Tailscale user identity.\n\n**Tasks:**\n1. Update page handlers to read Tailscale user from request context\n2. Display Tailscale user identity in UI (e.g., \"Logged in as alice@example.com\")\n3. Conditionally hide login/logout routes when Tailscale is enabled\n4. Update templates if needed to show Tailscale user info\n\n**User Context Extraction:**\n```go\nif tsUser := r.Context().Value(middleware.TailscaleUserKey); tsUser != nil {\n    user := tsUser.(string) // e.g., \"alice@example.com\"\n    // Use in template rendering\n}\n```\n\n**Verification:**\n- Manual test: access dashboard via Tailscale\n- Verify user identity displayed correctly\n- Verify login form not shown when Tailscale auth is active\n\n**Files Modified:**\n- internal/infrastructure/http/handlers/page_handler.go\n- internal/infrastructure/http/handlers/templates/*.templ (if needed)\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 7.","status":"open","priority":1,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":45,"created_at":"2026-01-13T12:45:42.616173Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:45:42.616173Z","labels":["handlers","ui"],"dependencies":[{"issue_id":"mjrwtf-ycu.7","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:45:42.617116Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.7","depends_on_id":"mjrwtf-ycu.4","type":"blocks","created_at":"2026-01-13T12:45:42.618634Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.8","title":"Add Integration Tests for Tailscale Mode","description":"Create comprehensive integration tests for Tailscale authentication.\n\n**Tasks:**\n1. Create `internal/infrastructure/http/server/tailscale_integration_test.go`\n2. Test scenarios:\n   - Public routes accessible without auth (both modes)\n   - Admin routes require valid Tailscale user (Tailscale mode)\n   - Admin routes use Bearer/Session auth (standard mode)\n   - WhoIs failure returns 401\n   - Both modes can coexist in same codebase\n\n**Test Structure:**\n```go\nfunc TestTailscaleMode_PublicRoutesAccessible(t *testing.T) {}\nfunc TestTailscaleMode_AdminRoutesProtected(t *testing.T) {}\nfunc TestStandardMode_FallbackAuth(t *testing.T) {}\nfunc TestTailscaleMode_WhoIsFailure(t *testing.T) {}\n```\n\n**Verification:**\n```bash\nmake test-integration\n```\n\n**Files Created:**\n- internal/infrastructure/http/server/tailscale_integration_test.go\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 8.","status":"open","priority":1,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":120,"created_at":"2026-01-13T12:45:54.340068Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:45:54.340068Z","labels":["testing"],"dependencies":[{"issue_id":"mjrwtf-ycu.8","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:45:54.342307Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.8","depends_on_id":"mjrwtf-ycu.6","type":"blocks","created_at":"2026-01-13T12:45:54.344833Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.8","depends_on_id":"mjrwtf-ycu.7","type":"blocks","created_at":"2026-01-13T12:45:54.347074Z","created_by":"Matt Riley"}]}
{"id":"mjrwtf-ycu.9","title":"Update Documentation for Tailscale Integration","description":"Document Tailscale configuration, setup, and usage.\n\n**Tasks:**\n1. Update README.md with Tailscale section\n2. Document new environment variables (TAILSCALE_ENABLED, etc.)\n3. Create Tailscale setup guide: `docs/tailscale-setup.md`\n   - Prerequisites (Tailscale account, auth key)\n   - Configuration steps\n   - Funnel setup instructions\n   - ACL recommendations\n4. Document migration path from Bearer token auth to Tailscale\n5. Add troubleshooting section\n6. Update docs-site if applicable\n\n**Sections to Add:**\n- Prerequisites\n- Environment Variables Reference\n- Setup Guide (step-by-step)\n- Funnel Configuration\n- ACL Configuration Examples\n- Migration Guide\n- Troubleshooting\n\n**Verification:**\n- Review documentation for accuracy and completeness\n- Verify all environment variables documented\n\n**Files Modified:**\n- README.md\n- docs/tailscale-setup.md (create)\n- docs-site/docs/getting-started/configuration.md (if exists)\n\n**Reference:** See `plans/2026-01-13_tailscale-tsnet-integration.md` Step 9.","status":"open","priority":2,"issue_type":"task","owner":"matt@mattriley.me","estimated_minutes":60,"created_at":"2026-01-13T12:46:04.384766Z","created_by":"Matt Riley","updated_at":"2026-01-13T12:46:04.384766Z","labels":["documentation"],"dependencies":[{"issue_id":"mjrwtf-ycu.9","depends_on_id":"mjrwtf-ycu","type":"parent-child","created_at":"2026-01-13T12:46:04.386481Z","created_by":"Matt Riley"},{"issue_id":"mjrwtf-ycu.9","depends_on_id":"mjrwtf-ycu.1","type":"blocks","created_at":"2026-01-13T12:46:04.389255Z","created_by":"Matt Riley"}]}
